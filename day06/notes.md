Looping through all the ways you can race rather than using some quick maths would be quite silly. An easy realisation is, firstly, the results of the different possibilities are mirrored. The first half of the possibilities has the exact same results as the second half. Another realisation is once you hit that first race you win, the rest of the races are all wins until we reach halfway. Combine those two and both part one and two are easy to solve. And a lack of big loops means big inputs are just as simple (part two)